<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Face Mask - MindAR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-three.prod.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #000;
            overflow: hidden;
        }
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #instructions {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 300px;
        }
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 18px;
            border-radius: 25px;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
        }
        #startButton:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 1001;
            display: none;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="instructions">
            <h3>üé≠ AR Face Mask</h3>
            <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–°—Ç–∞—Ä—Ç" –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –∫–∞–º–µ—Ä–∏ —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É AR –º–∞—Å–∫–∏!</p>
            <p>üì± –î–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏</p>
            <p>üòä –î–∏–≤—ñ—Ç—å—Å—è –ø—Ä—è–º–æ –≤ –∫–∞–º–µ—Ä—É</p>
        </div>
        <button id="startButton">üöÄ –°—Ç–∞—Ä—Ç AR</button>
        <div id="loading">‚è≥ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AR...</div>
    </div>

    <script>
        let mindarThree;
        let renderer, scene, camera;
        let maskGroup;
        let animationId;

        document.getElementById('startButton').addEventListener('click', startAR);

        async function startAR() {
            document.getElementById('startButton').style.display = 'none';
            document.getElementById('loading').style.display = 'block';

            try {
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è MindAR
                mindarThree = new window.MINDAR.FACE.MindARThree({
                    container: document.getElementById("container"),
                });

                // –û—á—ñ–∫—É—î–º–æ –∑–∞–ø—É—Å–∫ AR
                await mindarThree.start();

                // –û—Ç—Ä–∏–º–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ renderer, scene —ñ camera
                renderer = mindarThree.renderer;
                scene = mindarThree.scene;
                camera = mindarThree.camera;

                // –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Å–∫—É
                createFaceMask();

                document.getElementById('loading').style.display = 'none';
                document.getElementById('instructions').innerHTML = '<h3>üé≠ AR –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!</h3><p>–†—É—Ö–∞–π—Ç–µ –≥–æ–ª–æ–≤–æ—é –¥–ª—è –≤–∑–∞—î–º–æ–¥—ñ—ó –∑ –º–∞—Å–∫–æ—é</p>';

                // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é
                animate();

            } catch (error) {
                console.error('Error starting AR:', error);
                document.getElementById('loading').innerHTML = '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è AR. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏.';
            }
        }

        function createFaceMask() {
            // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä—É–ø—É –º–∞—Å–∫–∏
            maskGroup = new THREE.Group();

            // –î–æ–¥–∞—î–º–æ –∞–Ω–∫–µ—Ä (—Ç–æ—á–∫—É —Ñ—ñ–∫—Å–∞—Ü—ñ—ó –Ω–∞ –æ–±–ª–∏—á—á—ñ)
            const faceAnchor = mindarThree.addAnchor(1);

            // –°—Ç–≤–æ—Ä—é—î–º–æ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ñ –æ–∫—É–ª—è—Ä–∏
            const glassesGeometry = new THREE.TorusGeometry(0.15, 0.02, 8, 16);
            const glassesMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x2c3e50,
                transparent: true,
                opacity: 0.9
            });
            const leftLens = new THREE.Mesh(glassesGeometry, glassesMaterial);
            leftLens.position.set(-0.12, 0.05, 0);
            leftLens.rotation.x = Math.PI / 2;
            maskGroup.add(leftLens);

            const rightLens = new THREE.Mesh(glassesGeometry, glassesMaterial);
            rightLens.position.set(0.12, 0.05, 0);
            rightLens.rotation.x = Math.PI / 2;
            maskGroup.add(rightLens);

            // –ú—ñ—Å—Ç
            const bridgeGeometry = new THREE.CylinderGeometry(0.015, 0.015, 0.08, 8);
            const bridgeMaterial = new THREE.MeshBasicMaterial({ color: 0x2c3e50 });
            const bridge = new THREE.Mesh(bridgeGeometry, bridgeMaterial);
            bridge.position.set(0, 0.05, 0);
            bridge.rotation.z = Math.PI / 2;
            maskGroup.add(bridge);

            // –ê–Ω—ñ–º–æ–≤–∞–Ω—ñ —Å–µ—Ä—Ü—è
            for(let i = 0; i < 5; i++) {
                const heartShape = createHeartShape();
                const heartGeometry = new THREE.ShapeGeometry(heartShape);
                const heartMaterial = new THREE.MeshBasicMaterial({ 
                    color: Math.random() > 0.5 ? 0xff69b4 : 0xff1493,
                    transparent: true,
                    opacity: 0.8
                });
                const heart = new THREE.Mesh(heartGeometry, heartMaterial);
                heart.position.set(
                    (Math.random() - 0.5) * 0.8,
                    (Math.random() - 0.5) * 0.6,
                    Math.random() * 0.2 + 0.1
                );
                heart.scale.set(0.02, 0.02, 0.02);
                heart.userData = {
                    originalY: heart.position.y,
                    speed: Math.random() * 0.02 + 0.01,
                    amplitude: Math.random() * 0.1 + 0.05
                };
                maskGroup.add(heart);
            }

            // –°–ø–∞–ª–∞—Ö–∏
            const sparkleGroup = new THREE.Group();
            for(let i = 0; i < 10; i++) {
                const sparkleGeometry = new THREE.SphereGeometry(0.005, 4, 4);
                const sparkleMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xffd700,
                    transparent: true,
                    opacity: Math.random() * 0.8 + 0.2
                });
                const sparkle = new THREE.Mesh(sparkleGeometry, sparkleMaterial);
                sparkle.position.set(
                    (Math.random() - 0.5) * 0.6,
                    (Math.random() - 0.5) * 0.6,
                    Math.random() * 0.15 + 0.05
                );
                sparkle.userData = {
                    rotationSpeed: (Math.random() - 0.5) * 0.1,
                    scaleSpeed: Math.random() * 0.02 + 0.01
                };
                sparkleGroup.add(sparkle);
            }
            maskGroup.add(sparkleGroup);

            // –ê–Ω—ñ–º–æ–≤–∞–Ω–∏–π —É—Å–º—ñ—Ö
            const mustacheShape = createMustacheShape();
            const mustacheGeometry = new THREE.ShapeGeometry(mustacheShape);
            const mustacheMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x654321,
                transparent: true,
                opacity: 0.9
            });
            const mustache = new THREE.Mesh(mustacheGeometry, mustacheMaterial);
            mustache.position.set(0, -0.08, 0.05);
            mustache.scale.set(0.15, 0.15, 0.15);
            mustache.userData = { wiggleSpeed: 0.05 };
            maskGroup.add(mustache);

            // –î–æ–¥–∞—î–º–æ –≥—Ä—É–ø—É –º–∞—Å–∫–∏ –¥–æ –∞–Ω–∫–µ—Ä—É
            faceAnchor.group.add(maskGroup);
        }

        function createHeartShape() {
            const heartShape = new THREE.Shape();
            const x = 0, y = 0;
            heartShape.moveTo(x + 5, y + 5);
            heartShape.bezierCurveTo(x + 5, y + 5, x + 4, y, x, y);
            heartShape.bezierCurveTo(x - 6, y, x - 6, y + 3.5, x - 6, y + 3.5);
            heartShape.bezierCurveTo(x - 6, y + 5.5, x - 4, y + 7.7, x + 5, y + 12);
            heartShape.bezierCurveTo(x + 14, y + 7.7, x + 16, y + 5.5, x + 16, y + 3.5);
            heartShape.bezierCurveTo(x + 16, y + 3.5, x + 16, y, x + 10, y);
            heartShape.bezierCurveTo(x + 7, y, x + 5, y + 5, x + 5, y + 5);
            return heartShape;
        }

        function createMustacheShape() {
            const mustacheShape = new THREE.Shape();
            mustacheShape.moveTo(-5, 0);
            mustacheShape.quadraticCurveTo(-4, 2, -2, 1);
            mustacheShape.quadraticCurveTo(0, -1, 2, 1);
            mustacheShape.quadraticCurveTo(4, 2, 5, 0);
            mustacheShape.quadraticCurveTo(4, -2, 2, -1);
            mustacheShape.quadraticCurveTo(0, 1, -2, -1);
            mustacheShape.quadraticCurveTo(-4, -2, -5, 0);
            return mustacheShape;
        }

        function animate() {
            animationId = requestAnimationFrame(animate);

            if (maskGroup) {
                const time = Date.now() * 0.001;

                // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å–µ—Ä–¥–µ—Ü—å
                maskGroup.children.forEach(child => {
                    if (
                        child.geometry && 
                        child.geometry.type === 'ShapeGeometry' && 
                        (child.material.color.getHex() === 0xff69b4 || child.material.color.getHex() === 0xff1493)
                    ) {
                        child.position.y = child.userData.originalY + Math.sin(time * child.userData.speed) * child.userData.amplitude;
                        child.rotation.z = Math.sin(time * 2) * 0.2;
                    }
                });

                // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å–ø–∞–ª–∞—Ö—ñ–≤
                const sparkleGroup = maskGroup.children.find(c => c.type === 'Group');
                if (sparkleGroup) {
                    sparkleGroup.children.forEach(sparkle => {
                        sparkle.rotation.x += sparkle.userData.rotationSpeed;
                        sparkle.rotation.y += sparkle.userData.rotationSpeed * 0.7;
                        sparkle.scale.setScalar(1 + Math.sin(time * sparkle.userData.scaleSpeed) * 0.3);
                    });
                }

                // –ê–Ω—ñ–º–∞—Ü—ñ—è —É—Å–º—ñ—à–∫–∏
                const mustache = maskGroup.children.find(c => 
                    c.geometry && c.geometry.type === 'ShapeGeometry' && 
                    c.material.color.getHex() === 0x654321
                );
                if (mustache) {
                    mustache.rotation.z = Math.sin(time * mustache.userData.wiggleSpeed) * 0.1;
                }

                // –õ–µ–≥–∫–µ –æ–±–µ—Ä—Ç–∞–Ω–Ω—è –º–∞—Å–∫–∏
                maskGroup.rotation.z = Math.sin(time * 0.5) * 0.02;
            }

            renderer.render(scene, camera);
        }

        // –û–±—Ä–æ–±–∫–∞ –∑–º—ñ–Ω–∏ —Ä–æ–∑–º—ñ—Ä—É –≤—ñ–∫–Ω–∞
        window.addEventListener('resize', () => {
            if (mindarThree) {
                mindarThree.renderer.setSize(window.innerWidth, window.innerHeight);
                mindarThree.camera.aspect = window.innerWidth / window.innerHeight;
                mindarThree.camera.updateProjectionMatrix();
            }
        });

        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.addEventListener('beforeunload', () => {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            if (mindarThree) {
                mindarThree.stop();
            }
        });
    </script>
</body>
</html>
